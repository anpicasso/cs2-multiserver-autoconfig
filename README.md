**Overview**
- **Goal:** Orchestrate multiple CS2 server instances and a TMT2 web panel on one host.
- **Outputs:**
  - Managed servers JSON at `/home/tmt2/storage/managed_game_servers.json` (contains only RCON passwords).
  - Game passwords CSV at `./game_passwords.csv` (created next to the spawn script; contains game passwords per instance).
  - Access tokens file created by the TMT2 container at `/home/tmt2/storage/access_tokens.json` (printed by the script when available).

**Scripts**
- `1_spawn_cs2_instances.sh`: Boots/updates `cs2-multiserver`, spawns N CS2 instances, generates distinct game and RCON passwords, writes RCON info to JSON, and writes game passwords to a CSV.
- `2_run_tmt2.sh`: Installs Docker if missing (Debian/Ubuntu), runs the `tmt2` container, and prints the access tokens JSON once generated by the app.
- `3_stop.sh`: Stops the CS2 instances, stops the `tmt2` Docker container, and removes `/home/tmt2`.

**Requirements**
- **OS:** Debian/Ubuntu recommended (scripts auto-install dependencies with `apt-get`).
- **Permissions:** May use `sudo` to install packages and manage Docker and `/home/tmt2`.
- **Network:** Required to download dependencies, cs2-multiserver and pull Docker images.

**Setup**
- Make the scripts executable:
  - `chmod +x 1_spawn_cs2_instances.sh 3_stop.sh 2_run_tmt2.sh`

**1_spawn_cs2_instances.sh**
- **Usage:** `./1_spawn_cs2_instances.sh <count> <ip> <gslt> [start_game_port=27015] [start_tv_port=27050]`
- **What it does:**
  - Ensures dependencies (`jq`, `tmux`, etc.) on Debian/Ubuntu.
  - Downloads `cs2-multiserver` directly into the same directory where this script resides if missing.
  - Runs initial setup or update for `cs2-server`/`msm`.
  - Creates `/home/tmt2/storage` (with `sudo` if needed).
  - Starts `count` instances named `@game1 .. @gameN`, incrementing from the starting ports.
  - Generates distinct passwords per instance: a game password and an RCON password.
  - Writes `/home/tmt2/storage/managed_game_servers.json` with per-instance entries including the RCON password only.
  - Writes `./game_passwords.csv` with the game password per instance.
- **Arguments:**
  - `count`: number of instances to create.
  - `ip`: the public/private IP to publish in JSON.
  - `gslt`: your Steam Game Server Login Token.
  - `start_game_port`: first game port (default `27015`).
  - `start_tv_port`: first GOTV port (default `27050`).
- **Outputs:**
  - JSON at `/home/tmt2/storage/managed_game_servers.json` (reset each run). Example entry:
    - `{ "canBeUsed": true, "ip": "172.30.141.179", "port": 27015, "rconPassword": "4fWveB", "usedBy": null }`
  - CSV at `./game_passwords.csv` (reset each run) with header: `instance,port,game_password`.

**2_run_tmt2.sh**
- **Usage:** `./2_run_tmt2.sh`
- **What it does:**
  - Installs Docker (via `apt-get docker.io`) if missing and enables the service.
  - Ensures `/home/tmt2/storage` exists and is writable.
  - Runs the container: `docker run --name tmt2 -d -p 8080:8080 -v /home/tmt2/storage:/app/backend/storage jensforstmann/tmt2`.
  - Waits up to 60s for `/home/tmt2/storage/access_tokens.json` to be created by the app and prints its contents when available.
- **Access:** Open `http://localhost:8080` (or host IP:8080) in your browser.

**3_stop.sh**
- **Usage:** `./3_stop.sh`
- **What it does:**
  - If `/home/tmt2/storage/managed_game_servers.json` exists, determines instance count and stops `@game1..@gameN` via `msm`/`cs2-server`.
  - Stops the `tmt2` Docker container if present.
  - Removes `/home/tmt2` directory recursively. This is destructive by design.

**Typical Workflow**
- Start CS2 servers: `./1_spawn_cs2_instances.sh 3 172.30.141.179 YOUR_GSLT 27015 27050`
- Start TMT2: `./2_run_tmt2.sh` (then visit `http://localhost:8080`)
- Stop everything and clean storage: `./3_stop.sh`

**Notes**
- The `spawn` script downloads `cs2-multiserver` into the same directory as the script if not present. Running it in a clean directory is recommended.
- The managed servers JSON is recreated on each run and includes only the RCON password; the game passwords are stored in `./game_passwords.csv`.
- The CSV is overwritten on each run. Keep it secure, as it contains join passwords for your game servers.
- RCON and game passwords are generated randomly and are different per instance.
- `3_stop.sh` removes `/home/tmt2`. Any data under that path will be lost.
